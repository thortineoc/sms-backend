DROP TABLE IF EXISTS grades CASCADE;
DROP TABLE IF EXISTS Answers CASCADE;
DROP TABLE IF EXISTS Presences CASCADE;
DROP TABLE IF EXISTS Homeworks CASCADE;
DROP TABLE IF EXISTS Classes CASCADE;
DROP TABLE IF EXISTS Subjects CASCADE;
DROP TABLE IF EXISTS Groups CASCADE;
DROP TYPE IF EXISTS presence_type;




CREATE TYPE presence_type AS ENUM (
    'present',
    'absent',
    'late',
    'excused'
    );


CREATE TABLE Subjects (
                          id 		SERIAL PRIMARY KEY,
                          name 		varchar(63) 	NOT NULL UNIQUE
);

CREATE TABLE Groups (
			 id	SERIAL PRIMARY KEY,
			 name 	varchar(15)	NOT NULL UNIQUE
);

CREATE TABLE Classes (
                         id 		SERIAL PRIMARY KEY,
			 group_id 	int		NOT NULL,
                         subject_id 	int 		NOT NULL,
                         teacher_id 	varchar(63)	NOT NULL,
                         weekday 	int		NOT NULL,
                         room 		int		NOT NULL,
                         beginDate 	date		NOT NULL,
                         endDate	date		NOT NULL,
                         lesson		int		NOT NULL
);

CREATE TABLE Grades (
                        id 		SERIAL PRIMARY KEY,
                        class_id 	int 		NOT NULL,
                        student_id 	varchar(63) 	NOT NULL,
                        grade		int		NOT NULL,
                        description 	TEXT,
                        weight 		int 		DEFAULT 1
);

CREATE TABLE Homeworks (
                           id		SERIAL PRIMARY KEY,
                           title	varchar(255)	NOT NULL,
                           description	TEXT,
                           deadline	timestamp	NOT NULL,
                           file 	bytea,
                           class_id  	int 		NOT NULL
);

CREATE TABLE Presences (
                           id		SERIAL PRIMARY KEY,
                           student_id	varchar(63)	NOT NULL,
                           class_id	int		NOT NULL,
                           day		date		NOT NULL,
                           type		presence_type	DEFAULT 'present'
);

CREATE TABLE Answers (
                         id 		SERIAL PRIMARY KEY,
                         homework_id	int		NOT NULL,
                         student_id	varchar(63)	NOT NULL,
                         review		TEXT,
                         file		bytea
);


ALTER TABLE Grades
    ADD CONSTRAINT fk_grades_class_id
        FOREIGN KEY(class_id)
            REFERENCES Classes(id)
            ON DELETE SET NULL;

ALTER TABLE Classes
    ADD CONSTRAINT fk_classes_subject_id
        FOREIGN KEY(subject_id)
            REFERENCES Subjects(id)
            ON DELETE CASCADE;

ALTER TABLE Classes
    ADD CONSTRAINT fk_classes_group_id
        FOREIGN KEY(group_id)
            REFERENCES Groups(id)
            ON DELETE CASCADE;

ALTER TABLE Presences
    ADD CONSTRAINT fk_presences_class_id
        FOREIGN KEY(class_id)
            REFERENCES Classes(id)
            ON DELETE CASCADE;

ALTER TABLE Homeworks
    ADD CONSTRAINT fk_homeworks_class_id
        FOREIGN KEY(class_id)
            REFERENCES Classes(id)
            ON DELETE CASCADE;

ALTER TABLE Answers
    ADD CONSTRAINT fk_answers_homework_id
        FOREIGN KEY(homework_id)
            REFERENCES Homeworks(id)
            ON DELETE CASCADE;

